# Проектирование в пустоте

## Майкл Найгард

Система состоит из взаимозависимых программных элементов.
Организационная структура этих программных элементов вместе с объединяющими их
отношениями называется архитектурой. На диаграммах, изображающих
такие системы, отдельные программные элементы и серверы часто
упрощенно представлены в виде прямоугольников, соединенных стрелками.

Одна маленькая стрелка может означать: «Синхронный запрос/ответ в
формате SOAP-XML через HTTP». Для одного элемента диаграммы получается
слишком много информации. Места для полной записи обычно не хватает,
поэтому мы помечаем стрелку надписью «XML через HTTP» (с точки зрения
внутренней реализации) или «Поиск по коду товара» (с точки зрения
внешних пользователей).

Стрелка, связывающая программы, выглядит как непосредственный
контакт, но в действительности им не является. Пустота между
прямоугольниками заполнена аппаратными и программными компонентами. В частности,
здесь могут находиться:
- Сетевые карты
- Сетевые коммутаторы
- Брандмауэры
- Системы обнаружения и предотвращения вторжений (IDS/IPS)
- Брокеры или очереди сообщений
- Механизмы преобразования XML
- Серверы FTP
- Зонные таблицы
- Кольца SoNET
- Шлюзы MPLS
- Магистральные линии
- Океаны
- Рыболовные траулеры, повреждающие донные кабели

Между программными элементами А и Б всегда находятся четыре-пять
компьютеров, на которых работают программы коммутации пакетов, анализа
трафика, маршрутизации, анализа угроз и т. п. И вы как архитектор,
связывающий эти программные модули друг с другом, должны учитывать
существование этой промежуточной среды.

Однажды я видел стрелку с надписью «Исполнение». Один сервер был
установлен в компании моего клиента, второй находился совершенно в другом
месте. Эта жизненно важная для клиента стрелка запускала цепочку
событий, которая больше напоминала игру «Мышеловка», нежели единый
интерфейс. Сообщения передавались брокерам, сохраняющим их в файлах,
которые периодически запускаемыми заданиями загружались на FTP...
и т. д. Этот «интерфейс» включал в себя более 20 этапов.

Необходимо хорошо понимать, какая статическая и динамическая нагрузка
ложится на каждую стрелку. Рядом с «SOAP-XML через HTTP» около
стрелки стоило бы написать также: «С каждым запросом HTTP принимается одно
обращение, с каждым ответом HTTP возвращается один ответ. Ожидается
до 100 запросов в секунду, ответ в 99,999% случаев должен выдаваться
менее чем за 250 мс».

Но и это еще не все, что необходимо знать об этой стрелке:
- Что если вызывающая сторона обращается по ней слишком часто? Как
  должен действовать получатель - игнорировать запросы, вежливо
  отказывать или по возможности стараться их обработать?
- Что делать вызывающей стороне, если обработка запроса заняла более
  250 мс? Повторить попытку? Немного подождать? Решить, что на
  стороне получателя произошел сбой, и продолжить работу без этой функции?
- Что произойдет, если вызывающая сторона отправила запрос по
  протоколу версии 1.0, а получила ответ в версии 1.1? А если вместо XML был
  получен код HTML? Или файл в формате МРЗ вместо XML-файла?
- Что произойдет, если одна из сторон интерфейса станет временно
  недоступной?

Ответы на эти вопросы представляют собой суть проектирования «в пустом
пространстве» диаграмм.