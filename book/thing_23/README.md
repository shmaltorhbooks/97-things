# База данных как Крепость

## Дэн Чак

В базе данных хранится вся информация - как вводимая сотрудниками, так
и полученная от клиентов. Пользовательские интерфейсы, бизнес-логика
и прикладная логика (и даже сотрудники) приходят и уходят, а данные
остаются. Трудно выразить словами то, насколько важно в первые же дни
работы над проектом построить надежную модель данных.

Огромная популярность методологий гибкой разработки привела многих
к мысли, что приложения можно (и даже предпочтительно!) проектировать
по ходу работы. Эпоха предварительного написания сложных,
исчерпывающих технических спецификаций ушла навсегда! Новая школа призывает
поставлять продукт рано и часто. Одна строка эксплуатируемого кода
полезнее 10 строк у вас в голове. Звучит слишком хорошо, чтобы быть правдой...
во всяком случае в том, что касается данных.

В то время как бизнес-логика и пользовательские интерфейсы
эволюционируют довольно быстро, структурам данных и их отношениям это обычно не
свойственно. Следовательно, очень важно с самого начала четко определить
модель данных как на структурном, так и на аналитическом уровнях.
Миграция данных из одной схемы в другую «на месте» в лучшем случае сложна,
всегда занимает много времени и часто чревата ошибками. Если с
ошибками уровня приложения еще можно какое-то время мириться, ошибки в базе
данных могут привести к катастрофическим последствиям. Даже если вы
нашли и исправили ошибку проектирования на уровне данных, это не
восстановит поврежденную информацию.

Надежная модель данных - это такая модель, которая гарантирует
безопасность сегодняшних данных и может расширяться для данных завтрашних.
Гарантировать безопасность означает обеспечить неуязвимость для ошибок,
которые все равно (сколько бы усилий вы ни приложили) проникнут в вечно
изменяющийся прикладной уровень; поддерживать ссылочную целостность
данных; задавать ограничения предметной области везде, где они известны;
выбирать подходящие ключи, которые помогут обеспечить ссылочную
целостность и соблюдение ограничений. Обеспечить расширяемость означает
правильно нормализовать данные, чтобы модель данных можно было легко
дополнить новыми архитектурными уровнями, не прибегая к
использованию всевозможных лазеек и обходных путей.

База данных - последний страж, охраняющий ваши драгоценные данные.
Прикладной уровень, эфемерный по своей природе, не может следить за
собой сам. Для того чтобы база данных обеспечивала необходимую защиту,
модель данных нужно спроектировать так, чтобы она отвергала
неподходящие данные и не позволяла создавать отношения, не имеющие смысла.
Ключи, отношения по внешнему ключу и ограничения предметной области,
описанные в схеме, лаконичны, понятны, легко проверяются и в конечном
итоге самодокументируемы. Правила предметной области, закодированные
в модели данных, также имеют физический, долгосрочный характер; они не
теряются при изменениях в логике приложения.

Чтобы извлечь из реляционной базы данных максимальную пользу, то есть
сделать ее полноценной частью приложения, а не просто хранилищем
данных приложения, необходимо с самого начала хорошо понимать, что же
вы создаете. По мере развития вашего продукта будет совершенствоваться
и уровень данных, но в каждой фазе развития он должен сохранять свой
статус Крепости. И тогда вы сможете довериться ему и с уверенностью
возложить на него ответственность за перехват ошибок с других уровней
приложения - и он вас не разочарует.

> Дэн Чак (Dan Chak) - директор по разработке ПО в CourseAdvisor Inc.,
компании Washington Post. Является автором книги «Enterprise Rails»
(O'Reilly).